<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTU | Encryption as a service</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="w-4/5 mx-auto my-10">
    
    <div class="flex">
        <div class="mr-10">
            <img class="w-12" 
                    src="https://designguide.dtu.dk/-/media/subsites/designguide/design-basics/logo/dtu_logo_corporate_red_rgb.png"/>
        </div>
        <div>
            <h2 class="font-bold text-3xl">Encryption as a service</h2>
            <p class="text-md text-gray-300"><i>Online encryption and decryption service</i></p>
        </div>
    </div>


    <div class="flex items-center mt-10 align-center justify-center">
        <div class=" pr-5"><b>Nøgle:</b></div>
        <input id="key" class="w-full" type="text" value="a5f6ba42255643907a5bb3709840ca5b"/>
    </div>


    <p class="mt-10">
        <i>Kryptering:</i>
        <span class="text-sm ml-2 text-gray-300" id="encryptLoader"></span>
    </p>
    
    <div class=" flex">
        <div class="basis-1/2 ">
            <textarea id="encryptTextfieldInput" class="w-full outline-0 h-48 p-5 bg-gray-50 resize-none" 
                      placeholder="Skriv din tekst her"></textarea>
        </div>
        <div class="basis-1/2">
            <textarea id="encryptTextfieldOutput" class="w-full h-48 p-5 bg-gray-100 resize-none" 
                      placeholder="Din krypteret tekst kommer her" disabled></textarea>
        </div>
    </div>


    <p class="mt-10">
        <i>Dekryptering:</i>
        <span class="text-sm ml-2 text-gray-300" id="decryptLoader"></span>
    </p>
    
    <div class=" flex"> 
        <div class="basis-1/2 ">
            <textarea id="decryptTextfieldInput" class="w-full outline-0 h-48 p-5 bg-gray-50 resize-none" 
                      placeholder="Skriv din krypteret tekst her"></textarea>
        </div>
        <div class="basis-1/2">
            <textarea id="decryptTextfieldOutput" class="w-full h-48 p-5 bg-gray-100 resize-none" 
                      placeholder="Din tekst kommer her" disabled></textarea>
        </div>
    </div>

    <div class="mt-10">
        <p class="text-center text-gray-300 text-sm">
            Developed by Lukas Mittun Alexander Guldstøv | 
            s204174 & Maximilian Maria Olden-Jørgensen | 
            s204178 for course 34229
        </p>
    </div>
    
    <script>
        let uri = "http://localhost:8000";
       // let uri = "https://a2da6bc7-6dc5-4060-841e-da4caa456eb8.mock.pstmn.io";
 

        let req = (loaderId,textField,endpoint) => {

            document.getElementById(loaderId).innerHTML = ""

            // check the input that has keyup is empty
            if (document.getElementById(textField+"Input").value==""){
                setInput(textField,"")
                return
            }

            // check the key is not empty
            if (document.getElementById("key").value==""){
                alert("key can't be empty");
                return
            }

            document.getElementById(loaderId).innerHTML = "Loading..."
            
            var details = {
                'key': document.getElementById("key").value,
                'text': document.getElementById(textField+"Input").value,
            };

            var formBody = [];
            for (var property in details) {
                var encodedKey = encodeURIComponent(property);
                var encodedValue = encodeURIComponent(details[property]);
                formBody.push(encodedKey + "=" + encodedValue);
            }
            formBody = formBody.join("&");

            fetch(
                uri+endpoint, 
                {
                    method: 'POST',
                    redirect: 'follow',
                    mode:'no-cors',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formBody
                }
            )
            .then(response => response.text())
            .then(res =>  {
                setInput(textField,res)
                document.getElementById(loaderId).innerHTML = ""
            })
            .catch(error => console.log('error', error)) 
        }

        let setInput = (textFieldOutput,res) => {
            console.log(res)
            document.getElementById(textFieldOutput+"Output").value = res;
        }

        let encryptData = () => req("encryptLoader","encryptTextfield","/aes/encrypt")
        let decryptData = () => req("decryptLoader","decryptTextfield","/aes/decrypt")

        document.getElementById("encryptTextfieldInput").addEventListener("keyup",encryptData);
        document.getElementById("decryptTextfieldInput").addEventListener("keyup",decryptData);
         
 
    </script>
</body>
</html>